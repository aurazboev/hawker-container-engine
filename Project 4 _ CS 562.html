<!DOCTYPE html>
<!-- saved from url=(0062)https://khale.github.io/iit-cs562-s24-site/projects/05-hawker/ -->
<html lang="en-US" data-theme="light"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=Edge"><link rel="shortcut icon" href="https://khale.github.io/iit-cs562-s24-site/favicon.ico" type="image/x-icon"><link rel="stylesheet" href="./Project 4 _ CS 562_files/just-the-docs-default.css"> <script type="text/javascript" src="./Project 4 _ CS 562_files/lunr.min.js"></script> <script type="text/javascript" src="./Project 4 _ CS 562_files/just-the-docs.js"></script><meta name="viewport" content="width=device-width, initial-scale=1"><title>Project 4 | CS 562</title><meta name="generator" content="Jekyll v3.9.5"><meta property="og:title" content="Project 4"><meta name="author" content="Kyle Hale"><meta property="og:locale" content="en_US"><meta name="description" content="Into the Depths of Virtualization and Virtual Machines"><meta property="og:description" content="Into the Depths of Virtualization and Virtual Machines"><link rel="canonical" href="https://khale.github.io/iit-cs562-s24-site/projects/05-hawker/"><meta property="og:url" content="https://khale.github.io/iit-cs562-s24-site/projects/05-hawker/"><meta property="og:site_name" content="CS 562"><meta property="og:type" content="website"><meta name="twitter:card" content="summary"><meta property="twitter:title" content="Project 4"> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"Kyle Hale"},"description":"Into the Depths of Virtualization and Virtual Machines","headline":"Project 4","url":"https://khale.github.io/iit-cs562-s24-site/projects/05-hawker/"}</script><style type="text/css">iframe#teal-job-tracker-iframe-stable {
    min-width: 380px !important;
    width: 380px !important;
    min-height: 100vh !important;
    height: 100vh !important;
  }

  @media print {
    #teal-job-tracker-root-stable, #teal-job-tracker-companion-root-stable {
      display: none !important;
    }
  }</style></head><body data-new-gr-c-s-check-loaded="14.1190.0" data-gr-ext-installed=""> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"><title>Link</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"><title>Search</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"><title>Menu</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"><title>Expand</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"><title>Document</title><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <script type="text/javascript" src="./Project 4 _ CS 562_files/toggle_init.js"></script><div class="side-bar"><div class="site-header"> <a href="https://khale.github.io/iit-cs562-s24-site/" class="site-title lh-tight"> CS 562 </a> <a href="https://khale.github.io/iit-cs562-s24-site/projects/05-hawker/#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a></div><nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"><ul class="nav-list"><li class="nav-list-item"><a href="https://khale.github.io/iit-cs562-s24-site/calendar/" class="nav-list-link">Course Calendar</a></li><li class="nav-list-item"><a href="https://khale.github.io/iit-cs562-s24-site/assets/notes/emu/" class="nav-list-link">Emulation</a></li><li class="nav-list-item active"><a href="https://khale.github.io/iit-cs562-s24-site/projects/05-hawker/#" class="nav-list-expander"><svg viewBox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://khale.github.io/iit-cs562-s24-site/projects/" class="nav-list-link active">Projects</a><ul class="nav-list"><li class="nav-list-item"><a href="https://khale.github.io/iit-cs562-s24-site/projects/01-6502-prelim/" class="nav-list-link">Project 1 Prelim</a></li><li class="nav-list-item"><a href="https://khale.github.io/iit-cs562-s24-site/projects/02-6502/" class="nav-list-link">Project 1</a></li><li class="nav-list-item"><a href="https://khale.github.io/iit-cs562-s24-site/projects/03-hawkbeans/" class="nav-list-link">Project 2</a></li><li class="nav-list-item"><a href="https://khale.github.io/iit-cs562-s24-site/projects/04-micro-vmm/" class="nav-list-link">Project 3</a></li><li class="nav-list-item active"><a href="https://khale.github.io/iit-cs562-s24-site/projects/05-hawker/" class="nav-list-link active">Project 4</a></li><li class="nav-list-item"><a href="https://khale.github.io/iit-cs562-s24-site/projects/06-research/" class="nav-list-link">Project X</a></li></ul></li><li class="nav-list-item"><a href="https://khale.github.io/iit-cs562-s24-site/schedule/" class="nav-list-link">Schedule</a></li><li class="nav-list-item"><a href="https://khale.github.io/iit-cs562-s24-site/staff/" class="nav-list-link">Staff</a></li><li class="nav-list-item"><a href="https://khale.github.io/iit-cs562-s24-site/about/" class="nav-list-link">Syllabus</a></li></ul></nav><footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.</footer></div><div class="main" id="top"><div id="main-header" class="main-header"><div class="search"><div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search CS 562" aria-label="Search CS 562" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label></div><div id="search-results" class="search-results"></div></div><nav aria-label="Auxiliary" class="aux-nav"><ul class="aux-nav-list"><li class="aux-nav-list-item"> <a href="https://halek.co/" class="site-button"> Kyle C. Hale </a></li></ul></nav></div><div id="main-content-wrap" class="main-content-wrap"><nav aria-label="Breadcrumb" class="breadcrumb-nav"><ol class="breadcrumb-nav-list"><li class="breadcrumb-nav-list-item"> <a href="https://khale.github.io/iit-cs562-s24-site/projects/">Projects</a></li><li class="breadcrumb-nav-list-item"> <span>Project 4</span></li></ol></nav><div id="main-content" class="main-content" role="main"><h1 id="project-4-hawker-container-engine">Project 4: Hawker Container Engine</h1><p>Released: Thursday, 04/04/2024 <strong>Due Date: Thursday, 04/25/2024 11:59PM CST</strong></p><h2 id="overview">Overview</h2><p>This project is meant to give you an understanding of containers. You will be completing the implementation of a very basic container management engine, called <em>Hawker</em>. You’ll be implementing Hawker for Linux, and you’ll need to understand the two mechanisms that the Linux kernel provides to enable them, namely <a href="https://lwn.net/Articles/531114/#series_index">namespaces</a> and <a href="https://man7.org/linux/man-pages/man7/cgroups.7.html">cgroups</a>.</p><h2 id="hawker">Hawker</h2><p>You will not be implementing full container functionality, but enough to get the look and feel of working with more traditional container platforms. Basically, your system will allow us to run either a shell or command <em>inside</em> of a container. This container will be isolated in the following namespaces: UTS, PID, user, mount point (filesystem), network, and IPC. Your code will only need to deal with the first four (so we are assuming that you won’t be engaging in any networking or IPC activities inside your Hawker container).</p><h2 id="setup">Setup</h2><p>For this project, you’ll want to make sure to develop in a Linux environment. I’m using a Fedora 30 VM with Linux kernel 5.3.8. You can get away with using another distro, but you probably want to use one that has <code class="language-plaintext highlighter-rouge">systemd</code>, otherwise you can’t really count on the cgroup system being started at bootup (you can do this manually however, as outlined in the cgroups documentation linked below). You might first want to play around with <a href="https://www.docker.com/">Docker</a> or <a href="https://linuxcontainers.org/">LXC containers</a> to get a feel for how they should work. You should plan on using the LWN series on <a href="https://lwn.net/Articles/604609/">cgroups</a> and <a href="https://lwn.net/Articles/531114/#series_index">namespaces</a> as references.</p><h2 id="part-1-getting-started">Part 1: Getting started</h2><p>You’ll first want to install some dependencies, namely the development packages for <code class="language-plaintext highlighter-rouge">libcurl</code> v7.61 or greater and <code class="language-plaintext highlighter-rouge">libarchive</code>. Hawker uses these to grab images from the network. You should also install <code class="language-plaintext highlighter-rouge">libcap</code>. For example, on Fedora:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>dnf <span class="nb">install</span> <span class="nt">-y</span> libcurl-devel libarchive-devel libcap-devel
</code></pre></div></div><p>You can then check out the project code. You must run the setup script before attempting to use hawker. Otherwise, things will break. The setup script needs <code class="language-plaintext highlighter-rouge">sudo</code> access, so you will be asked for your <code class="language-plaintext highlighter-rouge">sudo</code> password when it runs.</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/khale/hawker-skeleton
<span class="nb">cd </span>hawker-skeleton
<span class="nb">sudo</span> ./setup.sh
make
</code></pre></div></div><p>The last command will build the skeleton, but don’t expect it to work properly yet! You will have to complete some functionality first. You should be able to run <code class="language-plaintext highlighter-rouge">hawker</code> now, but it won’t be very useful. To get an idea of how its used, you can run it without any arguments or like so:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./hawker <span class="nt">-h</span>
</code></pre></div></div><p>I’ve also provided a reference binary for you if you’d like to see a working copy doing its thing. You can get it like so:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl http://cs.iit.edu/~khale/class/vm-class/project-files/hawker-ref <span class="o">&gt;</span> hawker-ref
<span class="nb">chmod</span> +x hawker-ref
./hawker-ref <span class="nt">-h</span>
</code></pre></div></div><p>I’ve provided a single container image for you to test with (called <code class="language-plaintext highlighter-rouge">test</code>). You can use it with the reference binary to create an interactive shell inside the container like so:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> ./hawker-ref <span class="nb">test</span> /init
</code></pre></div></div><p>If you navigate around this container shell, you’ll see that this is just a very simple userspace environment (it’s a tiny <a href="https://busybox.net/">BusyBox</a> distribution).</p><p>Your first job is to get <code class="language-plaintext highlighter-rouge">hawker</code> to spawn off another process that will form the shell of the container. You’ll then use namespaces to isolate this process from the rest of the system and set up its environment.</p><h2 id="part-2-setting-up-isolation">Part 2: Setting up isolation</h2><h3 id="coding-task-1-setting-up-namespaces">Coding Task 1: Setting up namespaces</h3><p>When you first get the code, it’s not going to actually create a container. You should start by looking in <code class="language-plaintext highlighter-rouge">hawker.c</code>. This is where the heart of the engine is, and where you’ll be doing all of your work (you don’t need to edit <code class="language-plaintext highlighter-rouge">net,img.{c,h}</code> but you should understand what they’re doing!). All of the functionality that you need to implement is tagged with <code class="language-plaintext highlighter-rouge">FILL ME IN</code> comments in the source.</p><p>You should start with <code class="language-plaintext highlighter-rouge">main()</code> in <code class="language-plaintext highlighter-rouge">hawker.c</code>. The first thing the engine does is initialize its image server, which involves starting a network subsystem and an image cache (in a <code class="language-plaintext highlighter-rouge">.hawker</code> directory under your home directory). The image must be specified at the command line (just like the <code class="language-plaintext highlighter-rouge">docker</code> command). Hawker will then look for the image in its cache, and if it doesn’t find it, it will try to download the image from my image server (hosted on my IIT page). If it succeeds, it will extract the compressed image into the <code class="language-plaintext highlighter-rouge">~/.hawker/images/</code> directory.</p><p>This is where the fun begins. After user arguments are parsed, we need to create a new child process for the container. We will be using the <code class="language-plaintext highlighter-rouge">clone()</code> system call for this purpose. You’ll want to make sure the proper flags to <code class="language-plaintext highlighter-rouge">clone()</code> are set. The source tells you which namespaces you’ll need, and you can use the <code class="language-plaintext highlighter-rouge">man</code> page for <code class="language-plaintext highlighter-rouge">clone()</code> to determine the exact flags. At this point, the program will exit. You should remove this call to <code class="language-plaintext highlighter-rouge">exit()</code> and allocate a stack for the new process according to the comments in the source. It’s up to you whether to use a <code class="language-plaintext highlighter-rouge">malloc()</code> variant or <code class="language-plaintext highlighter-rouge">mmap()</code> to allocate your child process stack; both have their merits. A default stack size is given for you (<code class="language-plaintext highlighter-rouge">DEFAULT_STACKSIZE</code>) in <code class="language-plaintext highlighter-rouge">hawker.h</code>.</p><p>Once we have a stack, we can <code class="language-plaintext highlighter-rouge">clone()</code> with it. I’ve done this for you. Note that after the <code class="language-plaintext highlighter-rouge">clone</code> completes, we’ll have two processes running. The child process will be running in separate namespaces (according to the <code class="language-plaintext highlighter-rouge">clone</code> flags we set up). However, before we let the child container process loose, we must set up its environment, so we have to make it wait for us (the parent process) to finish that setup. I achieved this using <code class="language-plaintext highlighter-rouge">pipe()</code> (which you should remember from your OS class). We’re using it here as an asynchronous event notification mechanism. Essentially, the child waits on one end of the pipe for the parent to hang up the pipe, at which point the child can continue doing whatever it wants. Other notification mechanisms are possible.</p><p>The main thing we need to do here is set up the UID namespace mapping. By default, Linux does not set up a mapping from UIDs outside the container to UIDs inside the container, so the process will be setup with a default UID (2^16-1). However, we’d like our container to be running as root (UID 0) with group ID (GID) 0.</p><p>There are three files we need to modify (after the child is running) to set up these maps. <code class="language-plaintext highlighter-rouge">/proc/&lt;PID&gt;/uid_map</code>, <code class="language-plaintext highlighter-rouge">/proc/&lt;PID&gt;/setgroups</code> and <code class="language-plaintext highlighter-rouge">/proc/&lt;PID&gt;/gid_map</code>. See the <a href="https://lwn.net/Articles/531419/">LWN article</a> and the <a href="https://man7.org/linux/man-pages/man7/pid_namespaces.7.html">Linux man page</a> on PID namespaces for more details. You might want to use the <code class="language-plaintext highlighter-rouge">DEFAULT_MAP</code> constant provided in <code class="language-plaintext highlighter-rouge">hawker.h</code>.</p><p>Note that we don’t need to do this for the PID namespace, since Linux does this for us. The command we run will run with PID 1 (essentially as the init process). This creates some issues with signal handling and zombie processes since the kernel treats PID 1 as special. While we won’t be worrying about this, some commercial container systems <a href="https://engineeringblog.yelp.com/2016/01/dumb-init-an-init-for-docker.html">get around this</a> by spawning a special init process which then launches the user command as PID 2.</p><hr><p>If we build and run hawker at this point, a new process will be created in a separate set of namespaces (you should verify this with the <code class="language-plaintext highlighter-rouge">ps</code> command inside and outside of the container, and the <code class="language-plaintext highlighter-rouge">id</code> command inside the container), but things will still be broken because we haven’t set up the container’s environment (we’re not making use of the container image that the network/image subsystem is providing us). Your next task will address this.</p><h3 id="coding-task-2-setting-up-the-container-environment">Coding Task 2: Setting up the container environment</h3><p>We now move our attention to the code for the child process (<code class="language-plaintext highlighter-rouge">child_exec()</code> in <code class="language-plaintext highlighter-rouge">hawker.c</code>). At this point, the child is waiting for the parent to notify it that it should continue, but then it simply exits. You will fix this. We need the child to set up its new environment. To do that, we need to do four things:</p><ol><li>Change our root directory to the new directory for the image. This directory will be <code class="language-plaintext highlighter-rouge">~/.hawker/images/&lt;image-name&gt;</code>. You should add code that changes to this directory using the <code class="language-plaintext highlighter-rouge">chroot()</code> system call. You might want to make use of the <code class="language-plaintext highlighter-rouge">hkr_get_img()</code> function provided from <code class="language-plaintext highlighter-rouge">img.h</code>. This will require the image argument stored in the <code class="language-plaintext highlighter-rouge">struct parms</code> struct filled out by the argument parser.</li><li>Change our current directory to our new root directory. Use the <code class="language-plaintext highlighter-rouge">chdir()</code> system call here, but be careful! What directory path should we actually use here?</li><li>Set our new hostname. See the <code class="language-plaintext highlighter-rouge">sethostname()</code> system call. A default hostname is provided for you in <code class="language-plaintext highlighter-rouge">hawker.h</code>.</li><li>Execute the command provided by the user at the command line. We need to use the <code class="language-plaintext highlighter-rouge">execvp()</code> system call for this, which will create a new address space for us (the child process), load the binary file of the command provided, and execute it. Note that <code class="language-plaintext highlighter-rouge">execvp()</code> also takes arguments; these should be the arguments of the command (which can also be derived from the <code class="language-plaintext highlighter-rouge">struct parms</code> struct.</li></ol><hr><p>At this point, hawker should work correctly with namespaces. You can now test your version with the test image provided for you. For example, I might run:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> ./hawker <span class="nb">test</span> /bin/ls
</code></pre></div></div><p>Which should print out the contents of the root directory for the test container image. If I want to get an interactive shell for the container, I can run:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> ./hawker <span class="nb">test</span> /init
</code></pre></div></div><p>Note that this is a bit unlike how this is done in Docker. There are some subtleties when working with an init process and when allocating ttys (see the extra credit if you’d like to help make this closer to Docker). You should be able to run commands like <code class="language-plaintext highlighter-rouge">ls</code>, <code class="language-plaintext highlighter-rouge">cat</code>, and <code class="language-plaintext highlighter-rouge">ps</code> from the container now. Note the PIDs, hostnames, etc. that you see. You should also be able to use other commands provided by BusyBox (the test image is a BusyBox image).</p><p>There’s another special command in the container image called <code class="language-plaintext highlighter-rouge">hog</code>. All it is going to do is use as much CPU as possible. Open up another terminal and run <code class="language-plaintext highlighter-rouge">top</code> or <code class="language-plaintext highlighter-rouge">htop</code> in it. Then in your original terminal, run:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> ./hawker <span class="nb">test</span> /hog
</code></pre></div></div><p>Watch the CPU meter in your other terminal. Indeed, the <code class="language-plaintext highlighter-rouge">hog</code> command is doing what we thought it would, pegging your CPU. We want to prevent this from happening with our containers, so we need to introduce some notion of resource control.</p><h2 id="part-3-setting-up-resource-control">Part 3: Setting up resource control</h2><p>We want to be able to limit the amount of certain resouces that our container can use. For this project, you’ll only be dealing with the maximum amount of memory the container can use, and the amount of CPU it can use. Run <code class="language-plaintext highlighter-rouge">./hawker -h</code> to get an idea of how to use them. As it stands, if we pass values for the <code class="language-plaintext highlighter-rouge">-m</code> and <code class="language-plaintext highlighter-rouge">-c</code> flags, they’ll just be ignored. Your task here will be to fix this using Linux’s cgroup subsystem (make sure to do the reading on cgroups above).</p><h3 id="coding-task-3-cgroups-programming">Coding Task 3: cgroups programming</h3><p>For this task, you’ll want to bring your attention back to the <code class="language-plaintext highlighter-rouge">main()</code> function in <code class="language-plaintext highlighter-rouge">hawker.c</code>, right at the point with the comment that says <code class="language-plaintext highlighter-rouge">BEGIN RESOURCE CONTROL</code>. There are two things you must do here, setting CPU limits and memory limits. The cgroups subsystem is manipulated through the VFS subsystem (by reading and writing virtual files) rather than through standard system calls. Make sure to do the reading on cgroups to get an idea of how they’re used. The appropriate cgroup directories are already created for you (this is what the <code class="language-plaintext highlighter-rouge">setup.sh</code> script did).</p><p>You’ll have to modify a few files in these directories based on the values passed to the <code class="language-plaintext highlighter-rouge">-m</code> and <code class="language-plaintext highlighter-rouge">-c</code> flags by the user. The files of interest for CPU live in <code class="language-plaintext highlighter-rouge">/sys/fs/cgroup/cpuacct/hawker/&lt;container-PID&gt;</code>. The files are <code class="language-plaintext highlighter-rouge">cpu.cfs_quota_us</code> and <code class="language-plaintext highlighter-rouge">cpu.cfs_period_us</code>.</p><p>For memory, the file lives in <code class="language-plaintext highlighter-rouge">/sys/fs/cgroup/memory/hawker/&lt;container-PID&gt;</code>. The file of interest is <code class="language-plaintext highlighter-rouge">memory.limit_in_bytes</code>. This will prevent your container from using too much memory.</p><p>You’ll need to write appropriate values to these files to setup the proper resource control. However, you’re not done yet, because the resource controls you’ve set up have to be associated with a PID that is bound to them! For that, you’ll need to modify the <code class="language-plaintext highlighter-rouge">tasks</code> file in both of the above cgroups directories. You should think carefully here; which PID should be written to those files? Hint: why is the parent the one writing these files?</p><p>That’s it for this part!</p><hr><p>If you did the above task correctly, you should now be able to control the resources of your container. For example, if we re-run our previous example (using the <code class="language-plaintext highlighter-rouge">hog</code> program), we should see its resources being limited. Open up another terminal with <code class="language-plaintext highlighter-rouge">top</code> or <code class="language-plaintext highlighter-rouge">htop</code> again and run this:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> ./hawker <span class="nt">-c</span> 50 <span class="nb">test</span> /hog
</code></pre></div></div><p>You should now see that your container is only using 50% of the CPU! Cool.</p><p>That’s it! You’re done now. If you’ve finished quickly, take a look at the extra credit examples. Otherwise, you’re ready to handin.</p><h2 id="handin">Handin</h2><p>To hand in your project, you should run <code class="language-plaintext highlighter-rouge">make handin</code> while connected to the IIT network (or via VPN), as in previous projects. If you can’t hand in over the VPN, send the tarball to me via email.</p><h2 id="extra-credit-opportunities">Extra Credit Opportunities</h2><p>If you have time and want to extend your implementation, I’m willing to give you extra credit. You can propose your own extensions, but here are some ideas to start with:</p><ul><li>Have more than one container (see <code class="language-plaintext highlighter-rouge">docker ls</code> etc.)</li><li>Implement an actual backend image server with a database (e.g., in node.js)</li><li>Extend functionality to include network setup</li><li>Extend functionality to include IPC connections</li><li>Implement a serverless platform with <code class="language-plaintext highlighter-rouge">hawker</code> as a backend</li><li>Add functionality for piping commands to/from a container by connecting STDIN (see <code class="language-plaintext highlighter-rouge">docker -i</code>) and STDOUT properly</li><li>Add proper terminal handling (should allocate a ptty, see <code class="language-plaintext highlighter-rouge">docker -t</code>)</li><li>Add mount propagation to make changes within container permanent in the system</li><li>Make it possible to create device files (e.g., with <code class="language-plaintext highlighter-rouge">mknod</code>) from the new mount namespaces</li><li>Add ability to modify create/modify images using a <code class="language-plaintext highlighter-rouge">Hawkerfile</code> manifest (see <code class="language-plaintext highlighter-rouge">docker create</code>, <code class="language-plaintext highlighter-rouge">docker build</code>, <code class="language-plaintext highlighter-rouge">Dockerfiles</code> and company)</li></ul><h2 id="further-reading">Further Reading</h2><ul><li>How <a href="https://lwn.net/Articles/764761/">Facebook uses containers</a></li><li>Container orchestration with <a href="https://kubernetes.io/">Kubernetes</a></li><li><a href="https://dl.acm.org/doi/10.1145/3132747.3132763">Performance of VMs vs. Containers</a></li></ul><hr><footer><p class="text-small text-grey-dk-100 mb-0">Kyle C. Hale © 2024 <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></p></footer></div></div><div class="search-overlay"></div></div><script type="text/javascript" src="./Project 4 _ CS 562_files/toggle_mode.js"></script>
<div id="teal-job-tracker-root-stable" style="z-index: 2147483647;"><iframe id="teal-job-tracker-iframe-stable" style="background: rgb(255, 255, 255) !important; width: 380px !important; height: 100vh !important; position: fixed !important; inset: 0px -380px auto auto !important; z-index: 2147483647 !important; border: 0px !important; box-shadow: rgba(0, 0, 0, 0.25) 0px 0px 16px -3px !important; transition: right 0.25s ease-in-out !important; transform: none !important;" src="./Project 4 _ CS 562_files/saved_resource.html"></iframe></div><div id="teal-job-tracker-companion-root-stable" style="display: block; z-index: 2147483646; bottom: 58px; right: 0px; position: fixed; height: 60px; width: auto;"></div></body><grammarly-desktop-integration data-grammarly-shadow-root="true"><template shadowrootmode="open"><style>
      div.grammarly-desktop-integration {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select:none;
        user-select:none;
      }

      div.grammarly-desktop-integration:before {
        content: attr(data-content);
      }
    </style><div aria-label="grammarly-integration" role="group" tabindex="-1" class="grammarly-desktop-integration" data-content="{&quot;mode&quot;:&quot;full&quot;,&quot;isActive&quot;:true,&quot;isUserDisabled&quot;:false}"></div></template></grammarly-desktop-integration></html>